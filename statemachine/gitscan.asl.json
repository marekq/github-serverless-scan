{
    "Comment": "Scan the GitHub repositories of a user using Lambda",
    "StartAt": "Run GitHub Discovery",
    "States": {
      "Run GitHub Discovery": {
        "Type": "Task",
        "Resource": "arn:aws:states:::lambda:invoke",
        "InputPath": "$.GithubRepo",
        "OutputPath": "$.Payload",
        "Parameters": {
          "FunctionName": "${gitscanlambda}",
          "Payload": {  
            "GithubRepo.$": "$.GithubRepo"
         }
        },
        "Next": "Process Scan Results"
      },
      "Process Scan Results": {
        "Type": "Map",
        "Next": "Create Report",
        "ItemsPath": "$",
        "Parameters": {
          "MessageDetails.$": "$$.Map.Item.Value"
        },
        "Iterator": {
          "StartAt": "Run GitHub Scan",
          "States": {
            "Run GitHub Scan": {
              "Type": "Task",
              "Resource": "arn:aws:states:::lambda:invoke",
              "ResultPath": null,
              "Parameters": {
                "FunctionName": "${gitpulllambda}",
                "Payload": {  
                  "message.$": "$.MessageDetails"
               }
              },
              "End": true
            }
          }
        }
      },
      "Create Report": {
        "Type": "Task",
        "Resource": "arn:aws:states:::lambda:invoke",
        "OutputPath": "$",
        "InputPath": "$",
        "Parameters": {
          "FunctionName": "${genreportlambda}"
        },
        "Next": "Finish"
      },
      "Finish": {
        "Type": "Succeed",
        "InputPath": "$",
        "OutputPath": "$"
      }
    }
  }